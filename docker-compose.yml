services:
  fakturoid-api:
    build:
      context: .
      dockerfile: Dockerfile
    image: fakturoid-invoice-api
    pull_policy: build
    container_name: fakturoid-invoice-api
    restart: unless-stopped
    ports:
      - "8000"
    environment:
      - FAKTUROID_CLIENT_ID=${FAKTUROID_CLIENT_ID}
      - FAKTUROID_CLIENT_SECRET=${FAKTUROID_CLIENT_SECRET}
      # name
      - FAKTUROID_ACCOUNT_SLUG=${FAKTUROID_ACCOUNT_SLUG}
      # FakturoidBot (bot@example.com)
      - USER_AGENT=${USER_AGENT}
      - TEMPLATES_PATH=/app/config/templates.json
    volumes:
      # Mount config for easy template updates without rebuild
      - ./config:/app/config:ro
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:8000/health', timeout=5)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - nginx-proxy-manager_default
  
  networks:
    nginx-proxy-manager_default:
      external: true
